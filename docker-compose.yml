services:
  fbclicker:
    image: fbclicker-fbclicker:latest
    container_name: fbclicker
    restart: unless-stopped
    env_file:
      - .env
    ports:
      - "8081:8081"
    volumes:
      # Use Docker volume for persistence on remote host
      - fbclicker_data:/app/data
      - fbclicker_cache:/root/.cache
    environment:
      - TZ=Europe/Rome
      - DISPLAY=${DISPLAY:-:0}
      # RIDUCI I BATCH: Questo è il trucco principale per CPU vecchie
      # Default è spesso 32 o 64, che intasa la tua CPU. Mettiamolo basso.
      - DETECTOR_BATCH_SIZE=12
      - RECOGNITION_BATCH_SIZE=12

      # Sfrutta tutti e 4 i core fisici reali
      - OMP_NUM_THREADS=4
      - MKL_NUM_THREADS=4
      - PYTORCH_NUM_THREADS=4
      - TORCH_DEVICE=cpu

volumes:
  fbclicker_data:
    external: true
  fbclicker_cache:
    external: true
